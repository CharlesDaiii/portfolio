import{r as e,j as p}from"./jsx-runtime-Lfnj0zCF.js";import{u as Y,a as K,T as q,m as U,L as Z,t as $,c as J,n as O}from"./heading-DBM6cEeA.js";import{u as Q}from"./useInViewport-DazAZXCp.js";import{W as ee,p as te,av as re,e as se,S as ne,aw as ae,aa as oe,ax as ce,D as x,r as ie,c as ue,a as le,at as de,ab as me}from"./three-BQCeSpFW.js";import{u as E,t as pe}from"./throttle-DrBypvOF.js";import"./components-InTK3wdF.js";const fe="/assets/volkihar-cube-nx-B7Zjde9E.jpg",ve="/assets/volkihar-cube-ny-K8Ej-0KC.jpg",he="/assets/volkihar-cube-nz-CwSlGC5m.jpg",ge="/assets/volkihar-cube-px-B6VuHL6s.jpg",be="/assets/volkihar-cube-py-nbSfCjcD.jpg",we="/assets/volkihar-cube-pz-Bzqv8d-T.jpg",xe="/assets/volkihar-knight-BtFNLzdG.glb",Le="_armor_1r5zf_1",ye="_loader_1r5zf_7",ke="_canvas_1r5zf_16",L={armor:Le,loader:ye,canvas:ke},C={stiffness:40,damping:20,mass:1.5},Te=({showDelay:T=0,cameraPosition:f={x:0,y:0,z:6},className:M,alt:G,..._})=>{const[y,P]=e.useState(!1),[V,B]=e.useState(!1),[N,W]=e.useState(!1),u=e.useRef(),k=e.useRef(),l=e.useRef(),c=e.useRef(),n=e.useRef(),t=e.useRef(),v=e.useRef(),h=Q(u,!1,{threshold:.4}),j=Y(),g=E(0,C),b=E(0,C);e.useEffect(()=>{const{clientWidth:r,clientHeight:s}=u.current;t.current=new ee({canvas:k.current,alpha:!0,antialias:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0}),t.current.setPixelRatio(2),t.current.setSize(r,s),t.current.outputColorSpace=te,t.current.toneMapping=re,l.current=new se(36,r/s,.1,100),l.current.position.set(f.x,f.y,f.z),n.current=new ne;const a=new ae;c.current=new oe,n.current.add(c.current);const i=new ce(t.current);i.compileCubemapShader();const m=new x(16777215,2.6),S=new x(16777215,1),z=new x(16777215,1.3);m.position.set(1,.1,2),S.position.set(-1,.1,8),z.position.set(-2,2,-3),v.current=[z,m,S],v.current.forEach(o=>n.current.add(o));const A=async()=>{const o=de.loadAsync(xe),F=a.loadAsync([fe,ve,he,ge,be,we]),[w,I]=await Promise.all([o,F]);c.current.add(w.scene),w.scene.rotation.y=me.degToRad(180),w.scene.position.y=-1.6;const{texture:X}=i.fromCubemap(I);n.current.environment=X,i.dispose(),await t.current.initTexture(n.current.environment),c.current.traverse(async R=>{R.material&&await t.current.initTexture(R.material)}),P(!0),d()};e.startTransition(()=>{A(),setTimeout(()=>{W(!0)},1e3)});const H=g.on("change",o=>{c.current.rotation.x=o,d()}),D=b.on("change",o=>{c.current.rotation.y=o,d()});return()=>{ie(v.current),ue(n.current),le(t.current),H(),D()}},[]);const d=e.useCallback(()=>{t.current.render(n.current,l.current)},[]);return e.useEffect(()=>{const r=pe(s=>{const{innerWidth:a,innerHeight:i}=window,m={x:(s.clientX-a/2)/a,y:(s.clientY-i/2)/i};g.set(m.y/2),b.set(m.x/2)},100);return h&&B(!0),h&&!j&&window.addEventListener("mousemove",r),()=>{window.removeEventListener("mousemove",r)}},[h,j,g,b]),e.useEffect(()=>{const r=()=>{if(!u.current)return;const{clientWidth:s,clientHeight:a}=u.current;t.current.setSize(s,a),l.current.aspect=s/a,l.current.updateProjectionMatrix(),d()};return window.addEventListener("resize",r),r(),()=>{window.removeEventListener("resize",r)}},[d]),p.jsxs("div",{className:K(L.armor,M),ref:u,role:"img","aria-label":G,..._,children:[p.jsx(q,{unmount:!0,in:!y&&N,timeout:U($.base.durationL),children:({visible:r})=>p.jsx(Z,{className:L.loader,"data-visible":r})}),p.jsx("canvas",{className:L.canvas,ref:k,"data-loaded":y&&V,style:J({delay:O(T)})})]})};export{Te as Armor};
